      const username = document.getElementById('addTeacherUsername').value.trim();
      const password = document.getElementById('addTeacherPassword').value;
      if (!username || (!users[username] && !password)) {
        showNotification('Please provide a username and password for new teachers', 'error');
        return;
      }
      if (!userData[currentUser].classes.find(cls => cls.id === currentClassId)) {
        showNotification('Please select a class', 'error');
        return;
      }
      if (!users[username]) {
        users[username] = { password, type: 'teacher', school: users[currentUser].school };
        userData[username] = { classes: [], students: {}, history: {}, rewards: {}, powerups: {}, extras: {} };
        schools[users[currentUser].school].teachers.push(username);
      }
      if (!userData[username].classes.find(cls => cls.id === currentClassId)) {
        userData[username].classes.push(userData[currentUser].classes.find(cls => cls.id === currentClassId));
      }
      saveData();
      closeModal('addTeacherToClassModal');
      showNotification('Teacher added to class successfully', 'success');
      renderDashboard();
    }

    function createAdminAccount() {
      const username = document.getElementById('adminUsername').value.trim();
      const password = document.getElementById('adminPassword').value;
      const schoolName = document.getElementById('schoolName').value.trim();
      if (!username || !password || (selectedAccountType === 'admin' && !schoolName)) {
        showNotification('Please fill in all fields', 'error');
        return;
      }
      if (users[username]) {
        showNotification('Username already exists', 'error');
        return;
      }
      users[username] = { password, type: selectedAccountType, school: null };
      userData[username] = { classes: [], students: {}, history: {}, rewards: {}, powerups: {}, extras: {} };
      if (selectedAccountType === 'admin') {
        const schoolId = generateId();
        users[username].school = schoolId;
        schools[schoolId] = { name: schoolName, admins: [username], teachers: [] };
      }
      saveData();
      closeModal('createAdminModal');
      showNotification('Account created successfully', 'success');
      renderDashboard();
    }

    function addStudent() {
      const name = document.getElementById('studentName').value.trim();
      const points = parseInt(document.getElementById('initialPoints').value) || 0;
      const notes = document.getElementById('studentNotes').value.trim();
      const photo = document.getElementById('studentPhoto').files[0];
      if (!name || !currentClassId) {
        showNotification('Please provide a name and select a class', 'error');
        return;
      }
      const studentId = generateId();
      let photoUrl = '';
      if (photo) {
        const reader = new FileReader();
        reader.onload = () => {
          photoUrl = reader.result;
          students[studentId] = { id: studentId, name, points, classId: currentClassId, rewards: [], instantRewards: [], notes, photo: photoUrl };
          saveData();
          closeModal('addStudentModal');
          showNotification('Student added successfully', 'success');
          renderContent();
        };
        reader.readAsDataURL(photo);
      } else {
        students[studentId] = { id: studentId, name, points, classId: currentClassId, rewards: [], instantRewards: [], notes, photo: '' };
        saveData();
        closeModal('addStudentModal');
        showNotification('Student added successfully', 'success');
        renderContent();
      }
    }

    function openEditStudentModal(studentId) {
      currentStudentId = studentId;
      const student = students[studentId];
      document.getElementById('editStudentName').value = student.name;
      document.getElementById('editStudentNotes').value = student.notes || '';
      const editPhotoPreview = document.getElementById('editPhotoPreview');
      if (student.photo) {
        editPhotoPreview.src = student.photo;
        editPhotoPreview.style.display = 'block';
      } else {
        editPhotoPreview.style.display = 'none';
      }
      openModal('editStudentModal');
    }

    function updateStudent() {
      const name = document.getElementById('editStudentName').value.trim();
      const notes = document.getElementById('editStudentNotes').value.trim();
      const photo = document.getElementById('editStudentPhoto').files[0];
      if (!name) {
        showNotification('Please provide a name', 'error');
        return;
      }
      if (photo) {
        const reader = new FileReader();
        reader.onload = () => {
          students[currentStudentId].name = name;
          students[currentStudentId].notes = notes;
          students[currentStudentId].photo = reader.result;
          saveData();
          closeModal('editStudentModal');
          showNotification('Student updated successfully', 'success');
          renderContent();
        };
        reader.readAsDataURL(photo);
      } else {
        students[currentStudentId].name = name;
        students[currentStudentId].notes = notes;
        saveData();
        closeModal('editStudentModal');
        showNotification('Student updated successfully', 'success');
        renderContent();
      }
    }

    function deleteStudent() {
      if (confirm('Are you sure you want to delete this student?')) {
        delete students[currentStudentId];
        delete history[currentStudentId];
        Object.values(powerups).forEach(p => {
          if (p.studentId === currentStudentId) {
            delete powerups[p.id];
          }
        });
        saveData();
        closeModal('editStudentModal');
        showNotification('Student deleted successfully', 'success');
        renderContent();
      }
    }

    function addMultipleStudents() {
      const names = document.getElementById('multipleNames').value.trim().split('\n').map(name => name.trim()).filter(name => name);
      if (!currentClassId || names.length === 0) {
        showNotification('Please select a class and provide at least one name', 'error');
        return;
      }
      names.forEach(name => {
        const studentId = generateId();
        students[studentId] = { id: studentId, name, points: 0, classId: currentClassId, rewards: [], instantRewards: [], notes: '', photo: '' };
      });
      saveData();
      closeModal('addMultipleModal');
      showNotification(`${names.length} students added successfully`, 'success');
      renderContent();
    }

    function openPointsModal(studentId, action) {
      currentStudentId = studentId;
      document.getElementById('studentModalTitle').textContent = `${action === 'award' ? 'Award' : 'Deduct'} Points - ${sanitizeHTML(students[studentId].name)}`;
      document.getElementById('pointsChange').value = '';
      const reasonSelect = document.getElementById('pointsReason');
      reasonSelect.innerHTML = '<option value="">Select a reason or type a new one</option>';
      const classReasons = Object.values(reasons).filter(r => r.classId === currentClassId);
      classReasons.forEach(reason => {
        const option = document.createElement('option');
        option.value = reason.text;
        option.textContent = reason.text;
        reasonSelect.appendChild(option);
      });
      document.getElementById('pointsReasonInput').value = '';
      openModal('studentPointsModal');
    }

    function updateStudentPoints() {
      const points = parseInt(document.getElementById('pointsChange').value);
      const reason = document.getElementById('pointsReason').value || document.getElementById('pointsReasonInput').value.trim();
      if (isNaN(points) || points <= 0 || !reason) {
        showNotification('Please provide valid points and a reason', 'error');
        return;
      }
      const action = document.getElementById('studentModalTitle').textContent.includes('Award') ? 'award' : 'deduct';
      const multiplier = Object.values(powerups).find(p => p.studentId === currentStudentId && p.expiry > Date.now())?.multiplier || 1;
      const adjustedPoints = action === 'award' ? points * multiplier : -points;
      students[currentStudentId].points = Math.max(0, (students[currentStudentId].points || 0) + adjustedPoints);
      const historyId = generateId();
      history[historyId] = {
        id: historyId,
        studentId: currentStudentId,
        classId: currentClassId,
        type: action === 'award' ? 'Points Awarded' : 'Points Deducted',
        points: adjustedPoints,
        reason,
        date: Date.now()
      };
      if (!Object.values(reasons).some(r => r.text === reason && r.classId === currentClassId)) {
        const reasonId = generateId();
        reasons[reasonId] = { id: reasonId, text: reason, classId: currentClassId };
      }
      saveData();
      closeModal('studentPointsModal');
      showNotification(`Points ${action === 'award' ? 'awarded' : 'deducted'} successfully`, 'success');
      renderContent();
    }

    function openBulkPointsModal(action) {
      if (selectedStudents.size === 0) {
        showNotification('Please select at least one student', 'error');
        return;
      }
      const points = parseInt(document.getElementById('bulkPoints').value);
      if (isNaN(points) || points <= 0) {
        showNotification('Please provide valid points', 'error');
        return;
      }
      document.getElementById('bulkModalTitle').textContent = `${action === 'award' ? 'Award' : 'Deduct'} Points`;
      document.getElementById('bulkSummary').textContent = `You are about to ${action} ${points} points to ${selectedStudents.size} student${selectedStudents.size !== 1 ? 's' : ''}.`;
      const reasonSelect = document.getElementById('bulkReason');
      reasonSelect.innerHTML = '<option value="">Select a reason or type a new one</option>';
      const classReasons = Object.values(reasons).filter(r => r.classId === currentClassId);
      classReasons.forEach(reason => {
        const option = document.createElement('option');
        option.value = reason.text;
        option.textContent = reason.text;
        reasonSelect.appendChild(option);
      });
      document.getElementById('bulkReasonInput').value = '';
      openModal('bulkPointsModal');
    }

    function confirmBulkPoints() {
      const points = parseInt(document.getElementById('bulkPoints').value);
      const reason = document.getElementById('bulkReason').value || document.getElementById('bulkReasonInput').value.trim();
      if (isNaN(points) || points <= 0 || !reason) {
        showNotification('Please provide valid points and a reason', 'error');
        return;
      }
      const action = document.getElementById('bulkModalTitle').textContent.includes('Award') ? 'award' : 'deduct';
      selectedStudents.forEach(studentId => {
        const multiplier = Object.values(powerups).find(p => p.studentId === studentId && p.expiry > Date.now())?.multiplier || 1;
        const adjustedPoints = action === 'award' ? points * multiplier : -points;
        students[studentId].points = Math.max(0, (students[studentId].points || 0) + adjustedPoints);
        const historyId = generateId();
        history[historyId] = {
          id: historyId,
          studentId: studentId,
          classId: currentClassId,
          type: action === 'award' ? 'Points Awarded' : 'Points Deducted',
          points: adjustedPoints,
          reason,
          date: Date.now()
        };
      });
      if (!Object.values(reasons).some(r => r.text === reason && r.classId === currentClassId)) {
        const reasonId = generateId();
        reasons[reasonId] = { id: reasonId, text: reason, classId: currentClassId };
      }
      saveData();
      closeModal('bulkPointsModal');
      showNotification(`Points ${action === 'award' ? 'awarded' : 'deducted'} successfully`, 'success');
      clearSelection();
    }

    function selectRewardType(type, context) {
      selectedRewardType = type;
      document.querySelectorAll(`#${context === 'create' ? 'createRewardModal' : 'editRewardModal'} .reward-type-option`).forEach(btn => btn.classList.remove('active'));
      document.querySelector(`#${context === 'create' ? 'createRewardModal' : 'editRewardModal'} .reward-type-option[data-type="${type}"]`).classList.add('active');
      document.getElementById(`${context === 'create' ? '' : 'edit'}PointsRequiredGroup`).style.display = type === 'points' ? 'block' : 'none';
    }

    function createReward() {
      const title = document.getElementById('rewardTitle').value.trim();
      const description = document.getElementById('rewardDescription').value.trim();
      const points = parseInt(document.getElementById('rewardPoints').value);
      const icon = document.getElementById('rewardIcon').value.trim();
      if (!title || !description || (selectedRewardType === 'points' && (!points || points <= 0))) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      const rewardId = generateId();
      rewards[rewardId] = {
        id: rewardId,
        title,
        description,
        points: selectedRewardType === 'points' ? points : 0,
        type: selectedRewardType,
        classId: currentClassId,
        icon
      };
      saveData();
      closeModal('createRewardModal');
      showNotification('Reward created successfully', 'success');
      renderRewards();
    }

    function openEditRewardModal(rewardId) {
      currentRewardId = rewardId;
      const reward = rewards[rewardId];
      selectedRewardType = reward.type;
      document.getElementById('editRewardTitle').value = reward.title;
      document.getElementById('editRewardDescription').value = reward.description;
      document.getElementById('editRewardPoints').value = reward.points;
      document.getElementById('editRewardIcon').value = reward.icon || '';
      document.querySelectorAll('#editRewardModal .reward-type-option').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`#editRewardModal .reward-type-option[data-type="${reward.type}"]`).classList.add('active');
      document.getElementById('editPointsRequiredGroup').style.display = reward.type === 'points' ? 'block' : 'none';
      openModal('editRewardModal');
    }

    function updateReward() {
      const title = document.getElementById('editRewardTitle').value.trim();
      const description = document.getElementById('editRewardDescription').value.trim();
      const points = parseInt(document.getElementById('editRewardPoints').value);
      const icon = document.getElementById('editRewardIcon').value.trim();
      if (!title || !description || (selectedRewardType === 'points' && (!points || points <= 0))) {
        showNotification('Please fill in all required fields', 'error');
        return;
      }
      rewards[currentRewardId] = {
        ...rewards[currentRewardId],
        title,
        description,
        points: selectedRewardType === 'points' ? points : 0,
        type: selectedRewardType,
        icon
      };
      saveData();
      closeModal('editRewardModal');
      showNotification('Reward updated successfully', 'success');
      renderRewards();
    }

    function deleteReward() {
      if (confirm('Are you sure you want to delete this reward?')) {
        delete rewards[currentRewardId];
        saveData();
        closeModal('editRewardModal');
        showNotification('Reward deleted successfully', 'success');
        renderRewards();
      }
    }

    function openClaimRewardModal(rewardId) {
      currentRewardId = rewardId;
      const reward = rewards[rewardId];
      const content = document.getElementById('claimRewardContent');
      content.innerHTML = `
        <p>Claim "${sanitizeHTML(reward.title)}" for ${reward.points} points?</p>
        <div class="form-group">
          <label class="form-label" for="rewardStudent">Select Student</label>
          <select class="form-input" id="rewardStudent">
            ${Object.values(students)
              .filter(s => s.classId === currentClassId && s.points >= reward.points)
              .map(s => `<option value="${s.id}">${sanitizeHTML(s.name)} (${s.points} pts)</option>`).join('')}
          </select>
        </div>
      `;
      openModal('claimRewardModal');
    }

    function confirmClaimReward() {
      const studentId = document.getElementById('rewardStudent').value;
      const reward = rewards[currentRewardId];
      if (!studentId) {
        showNotification('Please select a student', 'error');
        return;
      }
      students[studentId].points -= reward.points;
      students[studentId].rewards = students[studentId].rewards || [];
      students[studentId].rewards.push(currentRewardId);
      const historyId = generateId();
      history[historyId] = {
        id: historyId,
        studentId,
        classId: currentClassId,
        type: 'Reward Claimed',
        points: -reward.points,
        reason: `Claimed ${reward.title}`,
        date: Date.now()
      };
      saveData();
      closeModal('claimRewardModal');
      showNotification('Reward claimed successfully', 'success');
      renderContent();
    }

    function openInstantRewardModal(rewardId) {
      currentRewardId = rewardId;
      const reward = rewards[rewardId];
      const content = document.getElementById('instantRewardContent');
      content.innerHTML = `
        <p>Give "${sanitizeHTML(reward.title)}" to a student?</p>
        <div class="form-group">
          <label class="form-label" for="instantRewardStudent">Select Student</label>
          <select class="form-input" id="instantRewardStudent">
            ${Object.values(students)
              .filter(s => s.classId === currentClassId)
              .map(s => `<option value="${s.id}">${sanitizeHTML(s.name)}</option>`).join('')}
          </select>
        </div>
      `;
      openModal('instantRewardModal');
    }

    function confirmGiveInstantReward() {
      const studentId = document.getElementById('instantRewardStudent').value;
      const reward = rewards[currentRewardId];
      if (!studentId) {
        showNotification('Please select a student', 'error');
        return;
      }
      students[studentId].instantRewards = students[studentId].instantRewards || [];
      students[studentId].instantRewards.push(currentRewardId);
      const historyId = generateId();
      history[historyId] = {
        id: historyId,
        studentId,
        classId: currentClassId,
        type: 'Instant Reward Given',
        points: 0,
        reason: `Received ${reward.title}`,
        date: Date.now()
      };
      saveData();
      closeModal('instantRewardModal');
      showNotification('Instant reward given successfully', 'success');
      renderContent();
    }

    function openClassDetail(classId) {
      currentClassId = classId;
      const cls = userData[currentUser].classes.find(c => c.id === classId);
      document.getElementById('classDetailTitle').textContent = sanitizeHTML(cls.name);
      const content = document.getElementById('classDetailContent');
      content.innerHTML = `
        <p><strong>Teacher:</strong> ${sanitizeHTML(cls.teacher)}</p>
        <h3>Students</h3>
        <table class="students-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Points</th>
              <th>Rewards</th>
              <th>Instant Rewards</th>
            </tr>
          </thead>
          <tbody>
            ${Object.values(students)
              .filter(s => s.classId === classId)
              .map(s => `
                <tr>
                  <td>${sanitizeHTML(s.name)}</td>
                  <td>${s.points}</td>
                  <td>${s.rewards?.length || 0}</td>
                  <td>${s.instantRewards?.length || 0}</td>
                </tr>
              `).join('')}
          </tbody>
        </table>
      `;
      document.getElementById('deleteClassBtn').onclick = () => deleteClass(classId);
      openModal('classDetailModal');
    }

    function deleteClass(classId) {
      if (confirm('Are you sure you want to delete this class?')) {
        userData[currentUser].classes = userData[currentUser].classes.filter(c => c.id !== classId);
        Object.values(users).forEach(user => {
          if (userData[user.username]?.classes) {
            userData[user.username].classes = userData[user.username].classes.filter(c => c.id !== classId);
          }
        });
        Object.keys(students).forEach(studentId => {
          if (students[studentId].classId === classId) {
            delete students[studentId];
            delete history[studentId];
          }
        });
        Object.keys(rewards).forEach(rewardId => {
          if (rewards[rewardId].classId === classId) {
            delete rewards[rewardId];
          }
        });
        Object.keys(powerups).forEach(powerupId => {
          if (powerups[powerupId].classId === classId) {
            delete powerups[powerupId];
          }
        });
        Object.keys(extras).forEach(extraId => {
          if (extras[extraId].classId === classId) {
            delete extras[extraId];
          }
        });
        saveData();
        closeModal('classDetailModal');
        showNotification('Class deleted successfully', 'success');
        renderDashboard();
      }
    }

    function openEditTeacherModal() {
      const cls = userData[currentUser].classes.find(c => c.id === currentClassId);
      currentTeacherUsername = cls.teacher;
      document.getElementById('editTeacherUsername').value = cls.teacher;
      document.getElementById('editTeacherPassword').value = '';
      document.getElementById('editTeacherConfirmPassword').value = '';
      openModal('editTeacherModal');
    }

    function updateTeacher() {
      const username = document.getElementById('editTeacherUsername').value.trim();
      const password = document.getElementById('editTeacherPassword').value;
      const confirmPassword = document.getElementById('editTeacherConfirmPassword').value;
      if (!username) {
        showNotification('Please provide a username', 'error');
        return;
      }
      if (password && password !== confirmPassword) {
        showNotification('Passwords do not match', 'error');
        return;
      }
      if (username !== currentTeacherUsername && users[username]) {
        showNotification('Username already exists', 'error');
        return;
      }
      const cls = userData[currentUser].classes.find(c => c.id === currentClassId);
      if (username !== currentTeacherUsername) {
        users[username] = { ...users[currentTeacherUsername], password: password || users[currentTeacherUsername].password };
        userData[username] = { ...userData[currentTeacherUsername] };
        userData[username].classes = userData[username].classes.map(c => c.id === currentClassId ? { ...c, teacher: username } : c);
        delete users[currentTeacherUsername];
        delete userData[currentTeacherUsername];
        schools[users[currentUser].school].teachers = schools[users[currentUser].school].teachers.map(t => t === currentTeacherUsername ? username : t);
        userData[currentUser].classes.find(c => c.id === currentClassId).teacher = username;
      } else if (password) {
        users[username].password = password;
      }
      saveData();
      closeModal('editTeacherModal');
      showNotification('Teacher updated successfully', 'success');
      openClassDetail(currentClassId);
    }

    function deleteTeacher() {
      if (confirm('Are you sure you want to delete this teacher?')) {
        userData[currentUser].classes = userData[currentUser].classes.filter(c => c.teacher !== currentTeacherUsername || c.id !== currentClassId);
        delete users[currentTeacherUsername];
        delete userData[currentTeacherUsername];
        schools[users[currentUser].school].teachers = schools[users[currentUser].school].teachers.filter(t => t !== currentTeacherUsername);
        saveData();
        closeModal('editTeacherModal');
        closeModal('classDetailModal');
        showNotification('Teacher deleted successfully', 'success');
        renderDashboard();
      }
    }

    function createPowerup() {
      const name = document.getElementById('powerupName').value.trim();
      const description = document.getElementById('powerupDescription').value.trim();
      const multiplier = parseFloat(document.getElementById('powerupMultiplier').value);
      const duration = parseInt(document.getElementById('powerupDuration').value);
      if (!name || !description || isNaN(multiplier) || multiplier <= 0 || isNaN(duration) || duration <= 0) {
        showNotification('Please fill in all required fields with valid values', 'error');
        return;
      }
      const powerupId = generateId();
      powerups[powerupId] = {
        id: powerupId,
        name,
        description,
        multiplier,
        duration,
        classId: currentClassId
      };
      saveData();
      closeModal('createPowerupModal');
      showNotification('Power Up created successfully', 'success');
      renderRewards();
    }

    function openEditPowerupModal(powerupId) {
      currentPowerupId = powerupId;
      const powerup = powerups[powerupId];
      document.getElementById('editPowerupName').value = powerup.name;
      document.getElementById('editPowerupDescription').value = powerup.description;
      document.getElementById('editPowerupMultiplier').value = powerup.multiplier;
      document.getElementById('editPowerupDuration').value = powerup.duration;
      openModal('editPowerupModal');
    }

    function updatePowerup() {
      const name = document.getElementById('editPowerupName').value.trim();
      const description = document.getElementById('editPowerupDescription').value.trim();
      const multiplier = parseFloat(document.getElementById('editPowerupMultiplier').value);
      const duration = parseInt(document.getElementById('editPowerupDuration').value);
      if (!name || !description || isNaN(multiplier) || multiplier <= 0 || isNaN(duration) || duration <= 0) {
        showNotification('Please fill in all required fields with valid values', 'error');
        return;
      }
      powerups[currentPowerupId] = {
        ...powerups[currentPowerupId],
        name,
        description,
        multiplier,
        duration
      };
      saveData();
      closeModal('editPowerupModal');
      showNotification('Power Up updated successfully', 'success');
      renderRewards();
    }

    function deletePowerup() {
      if (confirm('Are you sure you want to delete this power up?')) {
        delete powerups[currentPowerupId];
        saveData();
        closeModal('editPowerupModal');
        showNotification('Power Up deleted successfully', 'success');
        renderRewards();
      }
    }

    function assignPowerup(powerupId) {
      currentPowerupId = powerupId;
      const powerup = powerups[powerupId];
      const content = document.getElementById('claimRewardContent');
      content.innerHTML = `
        <p>Assign "${sanitizeHTML(powerup.name)}" to a student?</p>
        <div class="form-group">
          <label class="form-label" for="powerupStudent">Select Student</label>
          <select class="form-input" id="powerupStudent">
            ${Object.values(students)
              .filter(s => s.classId === currentClassId)
              .map(s => `<option value="${s.id}">${sanitizeHTML(s.name)}</option>`).join('')}
          </select>
        </div>
      `;
      openModal('claimRewardModal');
      document.querySelector('#claimRewardModal .btn-primary').onclick = confirmAssignPowerup;
    }

    function confirmAssignPowerup() {
      const studentId = document.getElementById('powerupStudent').value;
      if (!studentId) {
        showNotification('Please select a student', 'error');
        return;
      }
      const powerup = powerups[currentPowerupId];
      const powerupId = generateId();
      powerups[powerupId] = {
        ...powerup,
        id: powerupId,
        studentId,
        expiry: Date.now() + powerup.duration * 24 * 60 * 60 * 1000
      };
      saveData();
      closeModal('claimRewardModal');
      showNotification('Power Up assigned successfully', 'success');
      renderContent();
    }

    function addExtra() {
      const name = document.getElementById('extraName').value.trim();
      const url = document.getElementById('extraUrl').value.trim();
      if (!name || !url) {
        showNotification('Please provide a name and URL', 'error');
        return;
      }
      const extraId = generateId();
      extras[extraId] = { id: extraId, name, url, classId: currentClassId };
      saveData();
      closeModal('addExtraModal');
      showNotification('Extra added successfully', 'success');
      renderExtras();
    }

    function onSearchChange() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      if (currentView === 'students') {
        renderStudentGrid();
        renderStudentList();
        document.querySelectorAll('.student-card, .student-list-item').forEach(item => {
          const name = item.querySelector('.student-name, .student-list-name').textContent.toLowerCase();
          item.style.display = name.includes(search) ? '' : 'none';
        });
      } else if (currentView === 'rewards') {
        renderRewardsGrid();
        document.querySelectorAll('.reward-card').forEach(card => {
          const title = card.querySelector('.reward-title').textContent.toLowerCase();
          card.style.display = title.includes(search) ? '' : 'none';
        });
      } else if (currentView === 'leaderboard') {
        renderLeaderboard();
        document.querySelectorAll('.leaderboard-item').forEach(item => {
          const name = item.querySelector('.leaderboard-name').textContent.toLowerCase();
          item.style.display = name.includes(search) ? '' : 'none';
        });
      }
    }

    document.getElementById('classSelector').addEventListener('change', (e) => {
      currentClassId = e.target.value;
      renderContent();
    });

    init();
  </script>
</body>
</html>
